# Development Environment Variables
# Copy this file to .env (or .env.local) and adjust values for your machine.
# These values are consumed by docker-compose.dev.yml and every service.

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# PostgreSQL (Normalized Database)
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_HOST_PORT=7432
POSTGRES_DB=ecards_db
POSTGRES_USER=ecards_user
POSTGRES_PASSWORD=ecards_dev_password

# Cassandra (Canonical Event Store)
CASSANDRA_CLUSTER_NAME=ecards_cluster
CASSANDRA_HOSTS=cassandra
CASSANDRA_PORT=9042
CASSANDRA_NATIVE_PORT_HOST=7042
CASSANDRA_THRIFT_PORT_HOST=7160
CASSANDRA_KEYSPACE=ecards_canonical
CASSANDRA_DC=dc1
CASSANDRA_RACK=rack1
CASSANDRA_ENDPOINT_SNITCH=GossipingPropertyFileSnitch
CASSANDRA_NUM_TOKENS=256
CASSANDRA_JMX_PORT=7199

# Redis (Cache & Job Queue)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_HOST_PORT=7379
REDIS_PASSWORD=

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================

NODE_ENV=development

# API Server (internal service runs on API_INTERNAL_PORT inside the container)
API_PORT=7400
API_INTERNAL_PORT=4000
PORT=4000
API_URL=http://localhost:7400

# Frontend (Next.js dev server)
FRONTEND_HOST_PORT=7300
FRONTEND_PORT=3000
NEXT_PUBLIC_API_URL=http://localhost:7400
NEXT_PUBLIC_WS_URL=ws://localhost:7400

# Frontend OAuth Configuration (NEXT_PUBLIC_ prefix required for browser access)
# IMPORTANT: Use http:// or https:// as needed - the protocol will NOT be automatically upgraded
# Change to https:// in production or if your OAuth server requires HTTPS
# NOTE: NEXT_PUBLIC_OAUTH_CLIENT_ID must match OAUTH_CLIENT_ID (same OAuth client)
NEXT_PUBLIC_OAUTH_CLIENT_ID=ecards_app_dev
NEXT_PUBLIC_OAUTH_AUTHORIZATION_ENDPOINT=http://epicdev.com/oauth/authorize
NEXT_PUBLIC_OAUTH_TOKEN_ENDPOINT=http://epicdev.com/oauth/token
NEXT_PUBLIC_OAUTH_USER_INFO_ENDPOINT=http://epicdev.com/api/users/me
NEXT_PUBLIC_EXTERNAL_AUTH_URL=http://epicdev.com/app
NEXT_PUBLIC_USER_SUBSCRIPTION_URL=http://epicdev.com/app/features/user-subscription

# JWT (Development - change in production!)
JWT_SECRET=dev_jwt_secret_change_in_production
JWT_EXPIRY=7d

# Rate limiting (api-server)
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# ============================================================================
# LLM CONFIGURATION (Name Parsing)
# ============================================================================

# LLM Feature Toggle
LLM_ENABLED=true
LLM_PRIMARY_PROVIDER=openai
LLM_FALLBACK_PROVIDER=deepseek
LLM_CREDIT_COST=1
LLM_RETRY_ATTEMPTS=2
LLM_TIMEOUT_MS=10000

# OpenAI Configuration
# Get your API key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-proj-your-openai-api-key-here
OPENAI_MODEL=gpt-4o-mini
OPENAI_MAX_TOKENS=500
OPENAI_TEMPERATURE=0.3

# Anthropic Configuration
# Get your API key from: https://console.anthropic.com/settings/keys
ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key-here
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
ANTHROPIC_MAX_TOKENS=500
ANTHROPIC_TEMPERATURE=0.3

# DeepSeek Configuration
# Get your API key from: https://platform.deepseek.com/api_keys
DEEPSEEK_API_KEY=sk-your-deepseek-api-key-here
DEEPSEEK_MODEL=deepseek-chat
DEEPSEEK_MAX_TOKENS=500
DEEPSEEK_TEMPERATURE=0.3

# External LLM Service (Backward Compatibility)
EXTERNAL_LLM_API=http://remote-llm-server:5000/api/llm

# ============================================================================
# EXTERNAL SERVICES (Remote)
# ============================================================================

# SeaweedFS (Remote S3-Compatible Storage)
SEAWEEDFS_ENDPOINT=http://remote-seaweedfs-host:8888
SEAWEEDFS_ACCESS_KEY=your_seaweedfs_access_key
SEAWEEDFS_SECRET_KEY=your_seaweedfs_secret_key
SEAWEEDFS_BUCKET=ecards

# External Systems (epicdev.com)
# User App - OAuth 2.0 Server for authentication
EXTERNAL_AUTH_URL=http://epicdev.com/app

# Admin API - Backend services for user data, subscription, limits
EXTERNAL_USER_API=http://epicdev.com/admin/api
EXTERNAL_SUBSCRIPTION_WS=ws://epicdev.com/admin/ws

# ============================================================================
# AUTO-AUTH CONFIGURATION (OAuth 2.0 + PKCE)
# ============================================================================

# User Subscription Management URL
# Where users can view/upgrade their subscription in the Tools Dashboard
USER_SUBSCRIPTION_URL=http://epicdev.com/app/features/user-subscription

# OAuth 2.0 Endpoints (Tools Dashboard)
# IMPORTANT: Protocol (http/https) is NOT automatically upgraded
# Use http:// for local development, https:// for production
# Backend uses these for server-to-server calls
OAUTH_AUTHORIZATION_ENDPOINT=http://epicdev.com/oauth/authorize
OAUTH_TOKEN_ENDPOINT=http://epicdev.com/oauth/token
OAUTH_USER_INFO_ENDPOINT=http://epicdev.com/api/users/me

# OAuth 2.0 Client Credentials
# Register your E-Cards application in the Tools Dashboard App Library to get these
# Example Client ID: ecards_app_dev
# Example Client Secret: o940zNXww4xYvklk8HcmQEZEIeL1Yd-j (KEEP SECRET!)
OAUTH_CLIENT_ID=ecards_app_dev
OAUTH_CLIENT_SECRET=pQUQtR4fJLYH_9sfrPssE1Loz8HSeZ0D

# OAuth Redirect URIs (comma-separated)
# These MUST be registered in the Tools Dashboard App Library
# The redirect_uri in the auth request MUST exactly match one of these
# Development URLs:
OAUTH_REDIRECT_URIS=http://localhost:7300/auth/callback

# Production URLs (uncomment and add to OAUTH_REDIRECT_URIS when deploying):
# https://ecards.yourdomain.com/auth/callback,https://ecards.yourdomain.com/oauth/callback

# OAuth Scopes (requested permissions)
# Available scopes: profile, email, subscription, cards:read, cards:write, admin
OAUTH_SCOPES=profile email subscription

# Application ID (Tools Dashboard App Library Registration)
# This is the UUID assigned to your app in the Tools Dashboard App Library
# Used for: app identification, metrics, billing, backend API calls
# Example: 26c2f23d-6c50-482f-b1b6-e79b7ea53ecc
APPLICATION_ID=dc03bc0c-1eb5-431a-bf2e-638c45b419b1

# External API Authentication Key (for backend-to-backend calls)
# Used by api-server to call remote APIs for user verification
# May be used alongside APPLICATION_ID for backend authentication
EXTERNAL_API_KEY=your_api_key_for_backend_calls

# Token Encryption Key (for storing refresh tokens securely)
# Generate a secure key with: openssl rand -hex 32
# IMPORTANT: Keep this secret and rotate regularly (every 90 days)
# ⚠️ Changing this will invalidate all existing refresh tokens
TOKEN_ENCRYPTION_KEY=0000000000000000000000000000000000000000000000000000000000000000

# Session Cookie Configuration
SESSION_COOKIE_NAME=ecards_auth
REFRESH_COOKIE_NAME=ecards_refresh
SESSION_COOKIE_MAX_AGE=3600
REFRESH_COOKIE_MAX_AGE=2592000
SESSION_COOKIE_SECURE=false
SESSION_COOKIE_HTTP_ONLY=true
SESSION_COOKIE_SAME_SITE=strict

# PKCE Configuration (Proof Key for Code Exchange)
PKCE_ENABLED=true
PKCE_CODE_CHALLENGE_METHOD=S256

# OAuth State Parameter (CSRF Protection)
OAUTH_STATE_ENABLED=true

# Rate Limiting for Auth Endpoints (anti-brute-force)
AUTH_RATE_LIMIT_LOGIN_WINDOW=900000
AUTH_RATE_LIMIT_LOGIN_MAX=5
AUTH_RATE_LIMIT_CALLBACK_WINDOW=900000
AUTH_RATE_LIMIT_CALLBACK_MAX=10
AUTH_RATE_LIMIT_REFRESH_WINDOW=3600000
AUTH_RATE_LIMIT_REFRESH_MAX=20

# ============================================================================
# WORKER CONFIGURATION
# ============================================================================

WORKER_CONCURRENCY=4
WORKER_MAX_ATTEMPTS=3
WORKER_TIMEOUT=60000
RENDER_ENGINE=canvas

# ============================================================================
# FEATURE FLAGS
# ============================================================================

FEATURE_TEMPLATE_DESIGNER=true
FEATURE_BATCH_IMPORT=true
FEATURE_LLM_NAME_PARSING=true
FEATURE_WEBSOCKET_UPDATES=true

# ============================================================================
# LOGGING & DEBUG
# ============================================================================

LOG_LEVEL=debug
DEBUG=*
